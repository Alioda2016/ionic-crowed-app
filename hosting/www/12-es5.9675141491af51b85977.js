!function(){function e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],o=!0,r=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(c){r=!0,a=c}finally{try{o||null==s.return||s.return()}finally{if(r)throw a}}return n}(e,t)||n(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){var o;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(o=n(e))||t&&e&&"number"==typeof e.length){o&&(e=o);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){o=e[Symbol.iterator]()},n:function(){var e=o.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==o.return||o.return()}finally{if(c)throw i}}}}function n(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{gC6i:function(n,o,a){"use strict";a.r(o),a.d(o,"SearchPlacePageModule",(function(){return O}));var s,c=a("ofXK"),l=a("3Pt+"),u=a("TEn/"),g=a("tyNb"),d=a("mrSG"),f=a("fXoL"),b=a("sSZD"),h=((s=function(){function e(t){r(this,e),this.db=t,this.crowedPercentageListRef=t.list("/crowdInformation")}return i(e,[{key:"createCrowedPercentage",value:function(e){return this.crowedPercentageListRef.push({name:e.name,crowedPercentage:e.crowdPercentage})}},{key:"getCrowedPercentage",value:function(e){return this.crowedPercentageRef=this.db.object("/crowdInformation/"+e),this.crowedPercentageRef}},{key:"getCrowedPercentageList",value:function(){return this.crowedPercentageListRef=this.db.list("/crowdInformation"),this.crowedPercentageListRef}},{key:"updateCrowedPercentage",value:function(e,t){return this.crowedPercentageRef.update({name:t.name,crowedPercentage:t.crowdPercentage})}},{key:"deleteCrowedPercentage",value:function(e){this.crowedPercentageRef=this.db.object("/crowdInformation/"+e),this.crowedPercentageRef.remove()}}]),e}()).\u0275fac=function(e){return new(e||s)(f.Pb(b.a))},s.\u0275prov=f.Eb({token:s,factory:s.\u0275fac,providedIn:"root"}),s),m=a("5Px9"),p=a("Bfh1"),v=a("h+qT"),w=["map"];function P(e,t){if(1&e){var n=f.Mb();f.Lb(0,"ion-item",16),f.Tb("click",(function(){f.bc(n);var e=t.$implicit;return f.Vb().showPlace(e.name)})),f.Lb(1,"ion-label"),f.Lb(2,"h2"),f.fc(3),f.Kb(),f.Kb(),f.Kb()}if(2&e){var o=t.$implicit;f.yb(3),f.gc(" ",o.name," ")}}var y,C,k,x=[{path:"",component:(y=function(){function n(e,t,o,a,i,s,c,l,u,g){r(this,n),this.router=e,this.alert=t,this.sharedService=o,this.maxPercentageService=a,this.db=i,this.geolocation=s,this.nativeGeocoder=c,this.navCtrl=l,this.toastController=u,this.popoverController=g,this.circles={},this.status=!1,this.infoWindows=[],this.searchedPlaces=[],this.targetPlace={name:"coffee",crowedPercentage:30},this.showTabs=!1,this.data={name:"Kim Coffee",crowdPercentage:70},this.user={},this.markers=[{title:"kim's coffee",latitude:21.481995210456603,longitude:39.2382450551564}]}return i(n,[{key:"ngOnInit",value:function(){var e=this;this.sharedService.getCrowedPercentageList().valueChanges().subscribe((function(t){console.log("res: ",t);var n=t[0].name,o=t[0].crowedPercentage;console.log("name",n),e.username=e.maxPercentageService.getUsername(),console.log("usename",e.username),e.maxPercentageService.getMaxPercentage(e.username).valueChanges().subscribe((function(t){var n;for(n in console.log("resss",t),t)console.log("key: ",n),n===e.username?(e.maxPercentage=t[n].max_percentage,console.log("max",e.maxPercentage)):"max_percentage"==n&&(e.maxPercentage=t.max_percentage,console.log("max",e.maxPercentage))})),o>=e.maxPercentage&&e.showAlert("Notification","crowd percentage in "+n+" now is: "+o)}))}},{key:"logOut",value:function(){this.ConfirmLogOutAlert("Confirm","You'r about to logout")}},{key:"search",value:function(e){var t=this,n=e.target.value.toLowerCase();n.length>0?this.db.database.ref("crowdInformation").orderByChild("name").startAt(n).endAt(n+"\uf8ff").once("value",(function(e){t.searchedPlaces=[],e.exists()||(t.status=!0),e.forEach((function(e){t.searchedPlaces.push(e.val())}))})):(this.searchedPlaces=[],this.showMap(),this.showTabs=!1,this.status=!1)}},{key:"showPlace",value:function(e){var t=this;console.log(e);var n={center:new google.maps.LatLng(21.481995210456603,39.2382450551564),zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!1};this.map=new google.maps.Map(this.mapRef.nativeElement,n),this.addMarkersToMap(this.markers),this.sharedService.getCrowedPercentageList().valueChanges().subscribe((function(n){console.log("res: ",n),n.forEach((function(n){n.name==e&&(t.targetPlace=n,console.log("target place: ",t.targetPlace),console.log("address",t.address))}))})),e&&(this.showTabs=!0)}},{key:"ionViewDidEnter",value:function(){this.showMap()}},{key:"addMarkersToMap",value:function(e){var n,o=t(e);try{for(o.s();!(n=o.n()).done;){var r=n.value,a=new google.maps.LatLng(r.latitude,r.longitude);new google.maps.Marker({position:a,map:this.map}).setMap(this.map)}}catch(i){o.e(i)}finally{o.f()}}},{key:"showMarker",value:function(e){var t=this.markers[e.uuid],n=this.circles[e.uuid];t.isVisible()?(t.hideInfoWindow(),t.setVisible(!1),n.setVisible(!1)):(t.showInfoWindow(),t.setVisible(!0),n.setVisible(!0)),this.map.setAllGesturesEnabled(!0)}},{key:"closeAllInfoWindows",value:function(){var e,n=t(this.infoWindows);try{for(n.s();!(e=n.n()).done;)e.value.close()}catch(o){n.e(o)}finally{n.f()}}},{key:"showMap",value:function(){var e=new google.maps.LatLng(21.481995210456603,39.2382450551564);this.map=new google.maps.Map(this.mapRef.nativeElement,{center:e,zoom:12,disableDefaultUI:!1})}},{key:"ConfirmLogOutAlert",value:function(e,t){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var o,r=this;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.alert.create({cssClass:"my-custom-class",header:e,message:t,buttons:[{text:"OK",handler:function(){r.router.navigate(["home"])},cssClass:"alertButton"},{text:"Cancel"}]});case 2:return o=n.sent,n.next=5,o.present();case 5:case"end":return n.stop()}}),n,this)})))}},{key:"direct",value:function(){console.log("navigate button clicked!"),window.open("https://www.google.com/maps/dir/?api=1&destination="+this.markers[0].latitude+","+this.markers[0].longitude)}},{key:"navigateTo",value:function(){this.startNavigating()}},{key:"startNavigating",value:function(){var e=this,t=new google.maps.DirectionsService,n=new google.maps.DirectionsRenderer;n.setMap(this.map),this.geolocation.getCurrentPosition().then((function(o){t.route({origin:{lat:o.coords.latitude,lng:o.coords.longitude},destination:{lat:e.markers[0].latitude,lng:e.markers[0].longitude},travelMode:google.maps.TravelMode.DRIVING},(function(e,t){t==google.maps.DirectionsStatus.OK?n.setDirections(e):console.warn(t)}))})).catch((function(e){console.log("Error getting location",e)})),this.geolocation.watchPosition().subscribe((function(e){}))}},{key:"setPercentage",value:function(){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alert.create({cssClass:"my-custom-class",header:"Please set maximum crowdedness percentage",inputs:[{name:"crowdPercentage",type:"number",placeholder:"percentage",cssClass:"alertInput"}],buttons:[{text:"Submit",handler:function(e){return e.crowdPercentage>=0&&e.crowdPercentage<=100?(n.username=n.maxPercentageService.getUsername(),console.log(e),n.username&&n.maxPercentageService.addMaxPercentage(n.username,e.crowdPercentage).then((function(e){console.log(e),n.presentToast("Successfully, Maximum Percentage Added")}),(function(e){console.log(e)})),!0):(n.presentToast("Percentage Must be between 0 and 100"),!1)}}]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}}),e,this)})))}},{key:"presentToast",value:function(e){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.toastController.create({cssClass:"toast-class",message:e,duration:3e3,position:"top",animated:!0});case 2:t.sent.present();case 3:case"end":return t.stop()}}),t,this)})))}},{key:"showAlert",value:function(e,t){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark((function n(){var o;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,this.alert.create({cssClass:"my-custom-class",header:e,message:t,buttons:["Ok"]});case 2:return o=n.sent,n.next=5,o.present();case 5:case"end":return n.stop()}}),n,this)})))}},{key:"getAddressFromCoords",value:function(t,n){var o=this;console.log("getAddressFromCoords "+t+" "+n),this.nativeGeocoder.reverseGeocode(t,n,{useLocale:!0,maxResults:5}).then((function(t){o.address="";for(var n=[],r=0,a=Object.entries(t[0]);r<a.length;r++){var i=e(a[r],2),s=(i[0],i[1]);s.length>0&&n.push(s)}n.reverse();for(var c=0,l=n;c<l.length;c++){var u=l[c];o.address+=u+", "}o.address=o.address.slice(0,-2)})).catch((function(e){o.address="Address Not Available!"}))}}]),n}(),y.\u0275fac=function(e){return new(e||y)(f.Ib(g.g),f.Ib(u.a),f.Ib(h),f.Ib(m.a),f.Ib(b.a),f.Ib(p.a),f.Ib(v.a),f.Ib(u.z),f.Ib(u.E),f.Ib(u.C))},y.\u0275cmp=f.Cb({type:y,selectors:[["app-search-place"]],viewQuery:function(e,t){var n;1&e&&f.ic(w,!0,f.l),2&e&&f.Zb(n=f.Ub())&&(t.mapRef=n.first)},decls:33,vars:6,consts:[[3,"translucent"],["slot","start"],["animated","","placeholder","Search for place...","debounce","500",3,"ionChange"],["detail","","lines","full",3,"click",4,"ngFor","ngForOf"],[3,"hidden"],["slot","end","size","small",3,"click"],["name","log-out-outline","size","small"],["id","map"],["map",""],["slot","bottom",3,"hidden"],[1,"ion-text-wrap"],["name","people","size","small"],[1,"tabs"],[3,"click"],["name","play-forward","size","medium"],["name","people","size","medium"],["detail","","lines","full",3,"click"]],template:function(e,t){1&e&&(f.Lb(0,"ion-header",0),f.Lb(1,"ion-toolbar"),f.Lb(2,"ion-buttons",1),f.Jb(3,"ion-menu-button"),f.Kb(),f.Lb(4,"ion-searchbar",2),f.Tb("ionChange",(function(e){return t.search(e)})),f.Kb(),f.ec(5,P,4,1,"ion-item",3),f.Lb(6,"ion-item",4),f.Lb(7,"ion-label"),f.Lb(8,"h2"),f.fc(9," the place you search not found "),f.Kb(),f.Kb(),f.Kb(),f.Lb(10,"ion-button",5),f.Tb("click",(function(){return t.logOut()})),f.Jb(11,"ion-icon",6),f.Kb(),f.Kb(),f.Kb(),f.Lb(12,"ion-content"),f.Jb(13,"div",7,8),f.Kb(),f.Lb(15,"div",9),f.Lb(16,"ion-item-group"),f.Lb(17,"ion-item"),f.Lb(18,"ion-label",10),f.Jb(19,"ion-icon",11),f.Lb(20,"ion-text"),f.fc(21),f.Kb(),f.Kb(),f.Kb(),f.Lb(22,"ion-item"),f.Lb(23,"ion-tabs"),f.Lb(24,"ion-tab-bar",12),f.Lb(25,"ion-tab-button",13),f.Tb("click",(function(){return t.direct()})),f.Jb(26,"ion-icon",14),f.Lb(27,"Strong"),f.fc(28,"Direction"),f.Kb(),f.Kb(),f.Lb(29,"ion-tab-button",13),f.Tb("click",(function(){return t.setPercentage()})),f.Jb(30,"ion-icon",15),f.Lb(31,"Strong"),f.fc(32,"Percentage"),f.Kb(),f.Kb(),f.Kb(),f.Kb(),f.Kb(),f.Kb(),f.Kb()),2&e&&(f.Yb("translucent",!1),f.yb(5),f.Yb("ngForOf",t.searchedPlaces),f.yb(1),f.Yb("hidden",!t.status),f.yb(9),f.Yb("hidden",!t.showTabs),f.yb(6),f.hc(" The Crowd Percentage In ",t.targetPlace.name," now is: ",t.targetPlace.crowedPercentage," % "))},directives:[u.h,u.w,u.d,u.o,u.r,u.D,c.i,u.k,u.n,u.c,u.i,u.f,u.m,u.v,u.u,u.s,u.t],styles:["#map[_ngcontent-%COMP%]{width:100%}ion-text[_ngcontent-%COMP%]{color:#000;font-size:larger;font:700}ion-card[_ngcontent-%COMP%]{max-height:200px;overflow:scroll;position:absolute;z-index:1;margin-bottom:20%}ion-toolbar[_ngcontent-%COMP%]{--background:#e66f51;margin-left:0}ion-button[_ngcontent-%COMP%]{margin-top:14px;--background:#e9c36a}.my-custom-class[_ngcontent-%COMP%]{--background:#63254e}ion-icon[_ngcontent-%COMP%]{color:#000}ion-searchbar[_ngcontent-%COMP%]{--background:#e9c36a;color:#000;margin-left:0;margin-right:0;margin-top:10px}ion-item[_ngcontent-%COMP%]{--background:#e66f51;color:#000;margin-right:10}#map[_ngcontent-%COMP%]{height:100%}#container[_ngcontent-%COMP%]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}ion-content[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background:translucent}Strong[_ngcontent-%COMP%]{font-size:small;margin-bottom:auto}.tabs[_ngcontent-%COMP%], Strong[_ngcontent-%COMP%]{color:#941e30}.tabs[_ngcontent-%COMP%]{--background:#e66f51}"]}),y)}],M=((k=function e(){r(this,e)}).\u0275mod=f.Gb({type:k}),k.\u0275inj=f.Fb({factory:function(e){return new(e||k)},imports:[[g.i.forChild(x)],g.i]}),k),O=((C=function e(){r(this,e)}).\u0275mod=f.Gb({type:C}),C.\u0275inj=f.Fb({factory:function(e){return new(e||C)},imports:[[c.c,l.a,u.x,M]]}),C)}}])}();