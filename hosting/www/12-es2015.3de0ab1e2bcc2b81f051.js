(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{gC6i:function(e,t,n){"use strict";n.r(t),n.d(t,"SearchPlacePageModule",(function(){return w}));var o=n("ofXK"),s=n("3Pt+"),a=n("TEn/"),i=n("tyNb"),r=n("mrSG"),c=n("fXoL"),l=n("sSZD");let g=(()=>{class e{constructor(e){this.db=e,this.crowedPercentageListRef=e.list("/crowdInformation")}createCrowedPercentage(e){return this.crowedPercentageListRef.push({name:e.name,crowedPercentage:e.crowdPercentage})}getCrowedPercentage(e){return this.crowedPercentageRef=this.db.object("/crowdInformation/"+e),this.crowedPercentageRef}getCrowedPercentageList(){return this.crowedPercentageListRef=this.db.list("/crowdInformation"),this.crowedPercentageListRef}updateCrowedPercentage(e,t){return this.crowedPercentageRef.update({name:t.name,crowedPercentage:t.crowdPercentage})}deleteCrowedPercentage(e){this.crowedPercentageRef=this.db.object("/crowdInformation/"+e),this.crowedPercentageRef.remove()}}return e.\u0275fac=function(t){return new(t||e)(c.Pb(l.a))},e.\u0275prov=c.Eb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var d=n("5Px9"),h=n("Bfh1"),b=n("h+qT");const m=["map"];function u(e,t){if(1&e){const e=c.Mb();c.Lb(0,"ion-item",15),c.Tb("click",(function(){c.bc(e);const n=t.$implicit;return c.Vb().showPlace(n.name)})),c.Lb(1,"ion-label"),c.Lb(2,"h2"),c.fc(3),c.Kb(),c.Kb(),c.Kb()}if(2&e){const e=t.$implicit;c.yb(3),c.gc(" ",e.name," ")}}const p=[{path:"",component:(()=>{class e{constructor(e,t,n,o,s,a,i,r,c,l){this.router=e,this.alert=t,this.sharedService=n,this.maxPercentageService=o,this.db=s,this.geolocation=a,this.nativeGeocoder=i,this.navCtrl=r,this.toastController=c,this.popoverController=l,this.circles={},this.infoWindows=[],this.searchedPlaces=[],this.targetPlace={name:"coffee",crowedPercentage:30},this.showTabs=!1,this.data={name:"Kim Coffee",crowdPercentage:70},this.user={},this.markers=[{title:"kim's coffee",latitude:21.481995210456603,longitude:39.2382450551564}]}ngOnInit(){this.sharedService.getCrowedPercentageList().valueChanges().subscribe(e=>{console.log("res: ",e);let t=e[0].name,n=e[0].crowedPercentage;console.log("name",t),this.username=this.maxPercentageService.getUsername(),console.log("usename",this.username),this.maxPercentageService.getMaxPercentage(this.username).valueChanges().subscribe(e=>{var t;for(t in console.log("resss",e),e)console.log("key: ",t),t===this.username?(this.maxPercentage=e[t].max_percentage,console.log("max",this.maxPercentage)):"max_percentage"==t&&(this.maxPercentage=e.max_percentage,console.log("max",this.maxPercentage))}),n>=this.maxPercentage&&this.showAlert("Notification","crowd percentage in "+t+" now is: "+n)})}logOut(){this.ConfirmLogOutAlert("Confirm","You'r about to logout")}search(e){var t=e.target.value.toLowerCase();t.length>0?this.db.database.ref("crowdInformation").orderByChild("name").startAt(t).endAt(t+"\uf8ff").once("value",e=>{this.searchedPlaces=[],e.forEach(e=>{this.searchedPlaces.push(e.val()),console.log(this.searchedPlaces)})}):(this.searchedPlaces=[],this.showMap(),this.showTabs=!1)}showPlace(e){console.log(e);const t={center:new google.maps.LatLng(21.481995210456603,39.2382450551564),zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!1};this.map=new google.maps.Map(this.mapRef.nativeElement,t),this.addMarkersToMap(this.markers),this.sharedService.getCrowedPercentageList().valueChanges().subscribe(t=>{let n;console.log("res: ",t),n=t,n.forEach(t=>{t.name==e&&(this.targetPlace=t,console.log("target place: ",this.targetPlace),console.log("address",this.address))})}),e&&(this.showTabs=!0)}ionViewDidEnter(){this.showMap()}addMarkersToMap(e){for(let t of e){let e=new google.maps.LatLng(t.latitude,t.longitude);new google.maps.Marker({position:e,map:this.map}).setMap(this.map)}}showMarker(e){const t=this.markers[e.uuid],n=this.circles[e.uuid];t.isVisible()?(t.hideInfoWindow(),t.setVisible(!1),n.setVisible(!1)):(t.showInfoWindow(),t.setVisible(!0),n.setVisible(!0)),this.map.setAllGesturesEnabled(!0)}closeAllInfoWindows(){for(let e of this.infoWindows)e.close()}showMap(){const e=new google.maps.LatLng(21.481995210456603,39.2382450551564);this.map=new google.maps.Map(this.mapRef.nativeElement,{center:e,zoom:12,disableDefaultUI:!1})}ConfirmLogOutAlert(e,t){return Object(r.a)(this,void 0,void 0,(function*(){const n=yield this.alert.create({cssClass:"my-custom-class",header:e,message:t,buttons:[{text:"OK",handler:()=>{this.router.navigate(["home"])},cssClass:"alertButton"},{text:"Cancel"}]});yield n.present()}))}direct(){console.log("navigate button clicked!"),window.open("https://www.google.com/maps/dir/?api=1&destination="+this.markers[0].latitude+","+this.markers[0].longitude)}navigateTo(){this.startNavigating()}startNavigating(){let e=new google.maps.DirectionsService,t=new google.maps.DirectionsRenderer;t.setMap(this.map),this.geolocation.getCurrentPosition().then(n=>{e.route({origin:{lat:n.coords.latitude,lng:n.coords.longitude},destination:{lat:this.markers[0].latitude,lng:this.markers[0].longitude},travelMode:google.maps.TravelMode.DRIVING},(e,n)=>{n==google.maps.DirectionsStatus.OK?t.setDirections(e):console.warn(n)})}).catch(e=>{console.log("Error getting location",e)}),this.geolocation.watchPosition().subscribe(e=>{})}setPercentage(){return Object(r.a)(this,void 0,void 0,(function*(){const e=yield this.alert.create({cssClass:"my-custom-class",header:"Please set maximum crowdedness percentage",inputs:[{name:"crowdPercentage",type:"number",placeholder:"percentage",cssClass:"alertInput"}],buttons:[{text:"Submit",handler:e=>{this.username=this.maxPercentageService.getUsername(),console.log(e),this.username&&this.maxPercentageService.addMaxPercentage(this.username,e.crowdPercentage).then(e=>{console.log(e),this.presentToast("Successfully Your Maximum Percentage Added")},e=>{console.log(e)})}}]});yield e.present()}))}presentToast(e){return Object(r.a)(this,void 0,void 0,(function*(){(yield this.toastController.create({cssClass:"toast-class",message:e,duration:3e3,position:"middle",animated:!0})).present()}))}showAlert(e,t){return Object(r.a)(this,void 0,void 0,(function*(){const n=yield this.alert.create({cssClass:"my-custom-class",header:e,message:t,buttons:["Ok"]});yield n.present()}))}getAddressFromCoords(e,t){console.log("getAddressFromCoords "+e+" "+t),this.nativeGeocoder.reverseGeocode(e,t,{useLocale:!0,maxResults:5}).then(e=>{this.address="";let t=[];for(let[n,o]of Object.entries(e[0]))o.length>0&&t.push(o);t.reverse();for(let n of t)this.address+=n+", ";this.address=this.address.slice(0,-2)}).catch(e=>{this.address="Address Not Available!"})}}return e.\u0275fac=function(t){return new(t||e)(c.Ib(i.g),c.Ib(a.a),c.Ib(g),c.Ib(d.a),c.Ib(l.a),c.Ib(h.a),c.Ib(b.a),c.Ib(a.z),c.Ib(a.E),c.Ib(a.C))},e.\u0275cmp=c.Cb({type:e,selectors:[["app-search-place"]],viewQuery:function(e,t){var n;1&e&&c.ic(m,!0,c.l),2&e&&c.Zb(n=c.Ub())&&(t.mapRef=n.first)},decls:33,vars:5,consts:[[3,"translucent"],["slot","start"],["animated","","placeholder","Search for place...","debounce","500",3,"ionChange"],["detail","","lines","full",3,"click",4,"ngFor","ngForOf"],["slot","end","size","small",3,"click"],["name","log-out-outline","size","small"],["id","map"],["map",""],["slot","bottom",3,"hidden"],[1,"ion-text-wrap"],["name","people","size","small"],[1,"tabs"],[3,"click"],["name","play-forward","size","small"],["name","navigate","size","small"],["detail","","lines","full",3,"click"]],template:function(e,t){1&e&&(c.Lb(0,"ion-header",0),c.Lb(1,"ion-toolbar"),c.Lb(2,"ion-buttons",1),c.Jb(3,"ion-menu-button"),c.Kb(),c.Lb(4,"ion-searchbar",2),c.Tb("ionChange",(function(e){return t.search(e)})),c.Kb(),c.ec(5,u,4,1,"ion-item",3),c.Lb(6,"ion-button",4),c.Tb("click",(function(){return t.logOut()})),c.Jb(7,"ion-icon",5),c.Kb(),c.Kb(),c.Kb(),c.Lb(8,"ion-content"),c.Jb(9,"div",6,7),c.Kb(),c.Lb(11,"div",8),c.Lb(12,"ion-item-group"),c.Lb(13,"ion-item"),c.Lb(14,"ion-label",9),c.Lb(15,"ion-text"),c.Jb(16,"ion-icon",10),c.fc(17),c.Kb(),c.Kb(),c.Kb(),c.Lb(18,"ion-item"),c.Lb(19,"ion-tabs"),c.Lb(20,"ion-tab-bar",11),c.Lb(21,"ion-tab-button",12),c.Tb("click",(function(){return t.direct()})),c.Jb(22,"ion-icon",13),c.Lb(23,"Strong"),c.fc(24,"Direction"),c.Kb(),c.Kb(),c.Lb(25,"ion-tab-button",12),c.Tb("click",(function(){return t.navigateTo()})),c.Jb(26,"ion-icon",14),c.Lb(27,"Strong"),c.fc(28,"Navigation"),c.Kb(),c.Kb(),c.Lb(29,"ion-tab-button",12),c.Tb("click",(function(){return t.setPercentage()})),c.Jb(30,"ion-icon",10),c.Lb(31,"Strong"),c.fc(32,"Percentage"),c.Kb(),c.Kb(),c.Kb(),c.Kb(),c.Kb(),c.Kb(),c.Kb()),2&e&&(c.Yb("translucent",!1),c.yb(5),c.Yb("ngForOf",t.searchedPlaces),c.yb(6),c.Yb("hidden",!t.showTabs),c.yb(6),c.hc(" Crowd Percentage In ",t.targetPlace.name," now: ",t.targetPlace.crowedPercentage," "))},directives:[a.h,a.w,a.d,a.o,a.r,a.D,o.i,a.c,a.i,a.f,a.m,a.k,a.n,a.v,a.u,a.s,a.t],styles:["#map[_ngcontent-%COMP%]{width:100%}ion-card[_ngcontent-%COMP%]{max-height:200px;overflow:scroll;position:absolute;z-index:1;margin-bottom:20%}ion-toolbar[_ngcontent-%COMP%]{--background:#e66f51;margin-left:0}ion-button[_ngcontent-%COMP%]{margin-top:14px;--background:#e9c36a}.my-custom-class[_ngcontent-%COMP%]{--background:#63254e}ion-icon[_ngcontent-%COMP%]{color:#000}ion-searchbar[_ngcontent-%COMP%]{--background:#e9c36a;color:#000;margin-left:0;margin-right:0;margin-top:10px}ion-item[_ngcontent-%COMP%]{--background:#e66f51;color:#000;margin-right:10}#map[_ngcontent-%COMP%]{height:100%}#container[_ngcontent-%COMP%]{text-align:center;position:absolute;left:0;right:0;top:50%;transform:translateY(-50%)}#container[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{font-size:20px;line-height:26px}#container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;line-height:22px;color:#8c8c8c;margin:0}#container[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none}ion-content[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background:translucent}Strong[_ngcontent-%COMP%]{font-size:small;margin-bottom:auto}.tabs[_ngcontent-%COMP%], Strong[_ngcontent-%COMP%]{color:#941e30}.tabs[_ngcontent-%COMP%]{--background:#e66f51}"]}),e})()}];let f=(()=>{class e{}return e.\u0275mod=c.Gb({type:e}),e.\u0275inj=c.Fb({factory:function(t){return new(t||e)},imports:[[i.i.forChild(p)],i.i]}),e})(),w=(()=>{class e{}return e.\u0275mod=c.Gb({type:e}),e.\u0275inj=c.Fb({factory:function(t){return new(t||e)},imports:[[o.c,s.a,a.x,f]]}),e})()}}]);